From 56d7f6ed9c3b4ea7fd8402ad3c231c73279a902d Mon Sep 17 00:00:00 2001
From: steve westerhouse <amiga1.2k@gmail.com>
Date: Mon, 16 Feb 2026 14:38:05 -0600
Subject: [PATCH] Fix filter graph for openh264/libx264 encoders

---
 src/libopenh264encoder.cpp | 2 +-
 src/libx264encoder.cpp     | 2 +-
 2 files changed, 2 insertions(+), 2 deletions(-)

diff --git a/src/libopenh264encoder.cpp b/src/libopenh264encoder.cpp
index 5620aaf..5eb274c 100644
--- a/src/libopenh264encoder.cpp
+++ b/src/libopenh264encoder.cpp
@@ -34,7 +34,7 @@ LibOpenH264Encoder::LibOpenH264Encoder(H264Profile profile, PipeWireProduce *pro
     , m_profile(profile)
 {
     auto colorRange = m_colorRange == PipeWireBaseEncodedStream::ColorRange::Full ? u"full"_s : u"limited"_s;
-    m_filterGraphToParse = u"scale=format=yuv420p,out_range=%1"_s.arg(colorRange);
+    m_filterGraphToParse = u"format=yuv420p,scale=out_range=%1"_s.arg(colorRange);
 }
 
 bool LibOpenH264Encoder::initialize(const QSize &size)
diff --git a/src/libx264encoder.cpp b/src/libx264encoder.cpp
index 75facec..92d93c9 100644
--- a/src/libx264encoder.cpp
+++ b/src/libx264encoder.cpp
@@ -37,7 +37,7 @@ LibX264Encoder::LibX264Encoder(H264Profile profile, PipeWireProduce *produce)
     // Adjust the filter graph to ensure we are using an even frame size using a
     // pad filter. Otherwise the size adjustment below will insert a row/column
     // of garbage instead of black.
-    m_filterGraphToParse = u"pad=ceil(iw/2)*2:ceil(ih/2)*2,scale=format=yuv420p,out_range=%1"_s.arg(colorRange);
+    m_filterGraphToParse = u"format=yuv420p,pad=ceil(iw/2)*2:ceil(ih/2)*2,scale=out_range=%1"_s.arg(colorRange);
 }
 
 bool LibX264Encoder::initialize(const QSize &size)
-- 
2.51.0

